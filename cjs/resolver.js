"use strict";var path$1=require("path"),sequelize=require("sequelize");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var path__default=_interopDefaultLegacy(path$1),sequelize__default=_interopDefaultLegacy(sequelize),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}function getCjsExportFromNamespace(e){return e&&e.default||e}var type=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),injector=(unwrapExports(type),createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.servInjector=void 0,t.servInjector=function(d,f,p){let e="post";for(const t in p)if(p[t].method&&d?.$inject&&d?.$inject[t]&&d?.$inject[t][f]){e=p[t].method;break}let b=null,m=null;for(const n in p)if(p[n].intercept&&d?.$inject&&d?.$inject[n]&&d?.$inject[n][f]){b=p[n].intercept,m=d?.$inject[n][f]?.option;break}return[e,async e=>{const t={};let n=null;for(const s in p)if(p[s].before&&d?.$inject&&d?.$inject[s]&&d?.$inject[s][f]){const l=p[s].before.plugin;var r=await l(e,d?.$inject[s][f]?.option);t[s]=r,p[s].before.replaceProps&&(n=r)}t.data=e.request.body,null===n&&(n=t.data);let o=null,a=(o=b?await b(d[f],[n,t,e],m):await d[f](n,t,e),!1);for(const c in p)if(p[c].after){const u=p[c].after.plugin;var i;d?.$inject&&d?.$inject[c]&&d?.$inject[c][f]&&(i=await u(o,e,d?.$inject[c][f]?.option),t[c]=i,a=!0,p[c].after.replaceProps&&(e.body=i))}a||(e.body=o)}]}})),binder=(unwrapExports(injector),injector.servInjector,createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.restfulBinder=t.routeBinder=void 0;const d=["constructor","$inject","db"];t.routeBinder=function(e,t,n){const r={};for(var o in t){var a,i=t[o],s=Object.getOwnPropertyNames(i.prototype).filter(t=>d.every(e=>t.toLowerCase()!==e)),l=Reflect.construct(i,[]);for(a of s){var[u,c]=(0,injector.servInjector)(l,a,n);e[u](`/${o}/`+a,c),r[o+"_"+a]=c}}return r},t.restfulBinder=function(e,t){const r={};for(var n in t){var n=t[n],o=Object.getOwnPropertyNames(n.prototype).filter(e=>"constructor"!==e&&"$restful"!==e);const i=Reflect.construct(n,[]);for(let n of o){const{url:s,method:l}=i.$restful[n];var a=async e=>{if("get"===l?.toLowerCase()){var t=e["params"],t=await i[n](t||{},e);e.body=t}else if("post"===l?.toLowerCase()){t=e.request.body,t=await i[n](t,e);e.body=t}else if("put"===l?.toLowerCase()){t=e.request.body,t=await i[n](t,e);e.body=t}else{if("delete"!==l?.toLowerCase())return i[n](e);t=e["params"],t=await i[n](t||{},e);e.body=t}};"get"===l?.toLowerCase()?e.get(s,a):"post"===l?.toLowerCase()?e.post(s,a):"put"===l?.toLowerCase()?e.put(s,a):"delete"===l?.toLowerCase()?e.delete(s,a):e[l](s,a),r[""+s]=a}}return r}})),factory=(unwrapExports(binder),binder.restfulBinder,binder.routeBinder,createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.injectRemove=t.injectBind=void 0,t.injectBind=function(e,t,n){e.$inject||(e.$inject={});for(const r in n)e.$inject[r]?e.$inject[r][t]=n[r]:e.$inject[r]={[t]:n[r]}},t.injectRemove=function(e,t,n){e.$inject||(e.$inject={}),e.$inject[t]&&(n?delete e.$inject[t][n]:delete e.$inject[t])}})),builder=(unwrapExports(factory),factory.injectRemove,factory.injectBind,createCommonjsModule(function(e,t){function n(s,e){const l=e?.onDecorate||(()=>""),c=e?.onBefore||((...e)=>e),u=e?.onAfter||(e=>e);return i=>{return(t,e,{configurable:n,enumerable:r,value:o,writable:a})=>{l(t,e,i);return(0,factory.injectBind)(t,e,{[s]:{option:i}}),{configurable:n,enumerable:r,value:async(...e)=>{e=await c(...e),e=await o.apply(t,e);return await u(e)},writable:a}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.propsInjectorBuilder=t.classInjectorBuilder=t.funcInjectorBuilder=t.injectorBuilder=void 0,t.injectorBuilder=n,t.funcInjectorBuilder=n,t.classInjectorBuilder=function(n,e){const r=e?.onDecorate||((...e)=>e);return t=>{return e=>(r(e,t),(0,factory.injectBind)(e,"$class",{[n]:{option:t}}),e)}},t.propsInjectorBuilder=function(o,e){const a=e?.onDecorate||((...e)=>e);return r=>{return(e,t,n)=>{a(e,t,n,r),(0,factory.injectBind)(e,"$props",{[o]:{funcName:t,option:r}})}}}})),restful=(unwrapExports(builder),builder.propsInjectorBuilder,builder.classInjectorBuilder,builder.funcInjectorBuilder,builder.injectorBuilder,createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Post=t.Get=void 0,t.Get=function(i){return(t,e,{configurable:n,enumerable:r,value:o,writable:a})=>{return t.$restful?t.$restful[e]={url:i,method:"get"}:t.$restful={[e]:{url:i,method:"get"}},{configurable:n,enumerable:r,value:async(...e)=>{return await o.apply(t,e)},writable:a}}},t.Post=function(i){return(t,e,{configurable:n,enumerable:r,value:o,writable:a})=>{return t.$restful?t.$restful[e]={url:i,method:"post"}:t.$restful={[e]:{url:i,method:"post"}},{configurable:n,enumerable:r,value:async(...e)=>{return await o.apply(t,e)},writable:a}}}}));unwrapExports(restful),restful.Post,restful.Get;const fs=require("fs"),path=require("path"),os=require("os");function log(e){console.log("[dotenv][DEBUG] "+e)}const NEWLINE="\n",RE_INI_KEY_VAL=/^\s*([\w.-]+)\s*=\s*(.*)?\s*$/,RE_NEWLINES=/\\n/g,NEWLINES_MATCH=/\r\n|\n|\r/;function parse(e,t){const a=Boolean(t&&t.debug),i={};return e.toString().split(NEWLINES_MATCH).forEach(function(e,t){var n=e.match(RE_INI_KEY_VAL);if(null!=n){var r=n[1];let e=n[2]||"";var n=e.length-1,o='"'===e[0]&&'"'===e[n];"'"===e[0]&&"'"===e[n]||o?(e=e.substring(1,n),o&&(e=e.replace(RE_NEWLINES,NEWLINE))):e=e.trim(),i[r]=e}else a&&log(`did not match key and value when parsing line ${t+1}: `+e)}),i}function resolveHome(e){return"~"===e[0]?path.join(os.homedir(),e.slice(1)):e}function config(e){let t=path.resolve(process.cwd(),".env"),n="utf8",r=!1;e&&(null!=e.path&&(t=resolveHome(e.path)),null!=e.encoding&&(n=e.encoding),null!=e.debug&&(r=!0));try{const o=parse(fs.readFileSync(t,{encoding:n}),{debug:r});return Object.keys(o).forEach(function(e){Object.prototype.hasOwnProperty.call(process.env,e)?r&&log(`"${e}" is already defined in \`process.env\` and will not be overwritten`):process.env[e]=o[e]}),{parsed:o}}catch(e){return{error:e}}}module.exports.config=config,module.exports.parse=parse;var main=Object.freeze({__proto__:null}),require$$0=getCjsExportFromNamespace(main),configurator=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.standardTransfor=t.loadConfig=void 0,t.loadConfig=function(e){const{env:t,transfor:n}=e||{};let r="db.config.js",o={};return t&&(e=require$$0.config()["parsed"],o=e,r=`db.${o.DB_DRIVER}.js`),e=commonjsRequire(path__default.default.resolve(r)),n?n(e,o):e},t.standardTransfor=function(e){var t=e.driver,n=e.options;for(const r in n)if(r===t)return n[r];return[]}}),baseDefined=(unwrapExports(configurator),configurator.standardTransfor,configurator.loadConfig,createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DefineDatabase=void 0;t.DefineDatabase=class{orm={onCallBefore:async()=>"",onCallAfter:async()=>"",onCallError:async()=>"",connect:async()=>""};options={};constructor(e,t){this.options=t||{},this.orm=new e(t),Object.defineProperty(this.orm,"options",{get(){return this.options}})}async connect(...e){await this.orm?.connect(...e)}database(i){const s=this;return(n,r,{configurable:e,enumerable:t,value:o,writable:a})=>{return{configurable:e,enumerable:t,value:async(...e)=>{let t=void 0;try{await s.orm.onCallBefore.call(s.orm,n,r,i),t=await o.apply(n,e),await s.orm.onCallAfter.call(s.orm,n,r,i)}catch(e){throw await s.orm.onCallError.call(s.orm,n,r,i,e),e}return t},writable:a}}}}})),sequelize_loader=(unwrapExports(baseDefined),baseDefined.DefineDatabase,createCommonjsModule(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.baseTransfor=a.useTransaction=a.injectTransaction=a.OrmLoader=a.DefaultOptions=a.OrmSequelize=void 0;a.OrmSequelize=class{db},a.DefaultOptions={useBaseConfig:!0,useTransaction:!1,useAlwaysConnection:!1};function n(n,r){return{create:async(e,t)=>n.create(e,{transaction:r,...t}),update:async(e,t)=>n.update(e,{transaction:r,...t}),destroy:async e=>n.destroy({transaction:r,...e}),bulkCreate:async(e,t)=>n.bulkCreate(e,{transaction:r,...t}),findAll:async e=>n.findAll({transaction:r,...e}),findOne:async e=>n.findOne({transaction:r,...e}),max:async(e,t)=>n.max(e,{transaction:r,...t}),min:async(e,t)=>n.min(e,{transaction:r,...t}),sum:async(e,t)=>n.sum(e,{transaction:r,...t}),count:async e=>n.count({transaction:r,...e})}}function u(e,t){const r=n(e,t);return new Proxy(e,{get(e,t,n){return r[t]||Reflect.get(e,t,n)}})}a.OrmLoader=class{db={sequelize:void 0,transaction:void 0,tables:void 0};options;async connect(...e){var t=this.options.useBaseConfig??a.DefaultOptions.useBaseConfig;try{var n=(0,configurator.loadConfig)({env:!!t,transfor:t?a.baseTransfor:configurator.standardTransfor})||[];e&&0<e.length?this.db.sequelize=new sequelize__default.default.Sequelize(...e):this.db.sequelize=new sequelize__default.default.Sequelize(...n)}catch(e){}}async onCallBefore(e,t,n){(this.options?.useAlwaysConnection??a.DefaultOptions.useAlwaysConnection)||this.connect();var r=n?.useTransaction??a.DefaultOptions.useTransaction;r&&(this.db.transaction=await this.db.sequelize.transaction()),this.db.tables=this.declareTables(this.db.sequelize,this.db.transaction,n.tables,n.relation),e.db=this.db}async onCallAfter(e,t,n){var r=this.options?.useAlwaysConnection??a.DefaultOptions.useAlwaysConnection;if((n?.useTransaction??!1)&&await this.db.transaction.commit(),!r)try{await this.db.sequelize.close()}catch(e){}}async onCallError(e,t,n,r){var o=this.options?.useAlwaysConnection??a.DefaultOptions.useAlwaysConnection;if((n?.useTransaction??!1)&&await this.db.transaction.rollback(),!o)try{await this.db.sequelize.close()}catch(e){}}declareTables(r,n,e,t){const o={freezeTableName:!0,timestamps:!1},a=n=>(e,t)=>r.define(n,e,{...o,...t||{}}),i=e=>{let t=null;var n=this.options.tablesStructure[e](a(e),{s:r,t:e,o:o});return t=n instanceof Array?a(e)(n[0],n[1]):n};let s={};if(e&&0<e.length)e.forEach(e=>{var t=i(e);s[e]=n?u(t,n):t}),t&&t(s);else{for(const c in this.options.tablesStructure){var l=i(c);s[c]=n?u(l,n):l}this.options?.relation&&this.options.relation(s)}return s}},a.injectTransaction=n,a.useTransaction=u;a.baseTransfor=(e,t)=>{t=t.DB_DRIVER;return"sqlite"===t?[{dialect:"sqlite",storage:e.path}]:"mysql"===t?[e.database,e.username,e.password,{host:e.host,port:e.port,dialect:"mysql"}]:"postgres"===t?[e.database,e.username,e.password,{host:e.host,port:e.port,dialect:"postgres"}]:[]}})),sequelize_binder=(unwrapExports(sequelize_loader),sequelize_loader.baseTransfor,sequelize_loader.useTransaction,sequelize_loader.injectTransaction,sequelize_loader.OrmLoader,sequelize_loader.DefaultOptions,sequelize_loader.OrmSequelize,createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defineTables=void 0,t.defineTables=function(e,t,n){return{connect:(e=new baseDefined.DefineDatabase(sequelize_loader.OrmLoader,{tablesStructure:e,relation:t,...n||{}})).connect,Database:e.database}}})),dist=(unwrapExports(sequelize_binder),sequelize_binder.defineTables,createCommonjsModule(function(e,t){var r=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]}),n=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),n(type,t),n(binder,t),n(injector,t),n(builder,t),n(factory,t),n(restful,t),n(configurator,t),n(baseDefined,t),n(sequelize_loader,t),n(sequelize_binder,t)})),index=unwrapExports(dist);module.exports=index;
